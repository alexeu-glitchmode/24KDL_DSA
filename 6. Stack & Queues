// Bài 1
#include <stdio.h>
#include <string.h>

#define MAX 1000

typedef struct {
    char a[MAX];
    int top;
} Stack;

void init(Stack *s){
    s->top = -1;
}

int isEmpty(Stack* s){
    return s->top == -1;
}

int isFull(Stack* s){
    return s->top == MAX - 1;
}

void push(Stack* s, char value){
    s->top++;
    s->a[s->top] = value;
}

char pop(Stack* s){
    char data = s->a[s->top];
    s->top--;
    return data;
}

void reverseByArray(char str[]){
    int left = 0;
    int right = strlen(str) - 1;
    char temp;

    while(left < right){
        temp = str[left];
        str[left] = str[right];
        str[right] = temp;
        left++;
        right--;
    }
}

void reverseByStack(char str[]){
    Stack s;
    init(&s);

    int len = strlen(str);
    for(int i = 0; i < len; i++){
        push(&s, str[i]);
    }

    for(int i = 0; i < len; i++){
        str[i] = pop(&s);
    }
}

int main(){
    char str1[MAX], str2[MAX];

    printf("Nhap chuoi: ");
    fgets(str1, MAX, stdin);
    str1[strcspn(str1, "\n")] = '\0';

    strcpy(str2, str1); 

    reverseByArray(str1);
    reverseByStack(str2);

    printf("Dao chuoi (Mang):  %s\n", str1);
    printf("Dao chuoi (Stack): %s\n", str2);

    return 0;
}


//Bài 2
#include <stdio.h>
#include <string.h>

#define MAX 1000

typedef struct {
    char bracket;
    int pos;
} Item;

typedef struct {
    Item a[MAX];
    int top;
} Stack;

// Khoi tao stack
void init(Stack *s){
    s->top = -1;
}

// Kiem tra rong
int isEmpty(Stack *s){
    return s->top == -1;
}

// Push
void push(Stack *s, char c, int pos){
    s->top++;
    s->a[s->top].bracket = c;
    s->a[s->top].pos = pos;
}

// Pop
Item pop(Stack *s){
    Item temp = s->a[s->top];
    s->top--;
    return temp;
}

// Kiem tra cap ngoac hop le
int isMatching(char open, char close){
    if(open == '(' && close == ')') return 1;
    if(open == '[' && close == ']') return 1;
    if(open == '{' && close == '}') return 1;
    return 0;
}

// Tim ngoac dong dung voi ngoac mo
char getCorrectClose(char open){
    if(open == '(') return ')';
    if(open == '[') return ']';
    if(open == '{') return '}';
    return '?';
}

int main(){
    char expr[MAX];
    Stack s;
    init(&s);

    printf("Nhap bieu thuc: ");
    fgets(expr, MAX, stdin);
    expr[strcspn(expr, "\n")] = '\0';

    int i;
    int error = 0;

    for(i = 0; i < strlen(expr); i++){
        char c = expr[i];

        // Ngoac mo
        if(c == '(' || c == '[' || c == '{'){
            push(&s, c, i);
        }
        // Ngoac dong
        else if(c == ')' || c == ']' || c == '}'){
            Item topItem = pop(&s);

            if(!isMatching(topItem.bracket, c)){
                printf("\n Error at %d\n", i);
                printf("   Ngoac mo: %c (vi tri %d)\n", topItem.bracket, topItem.pos);
                printf("   Ngoac dong: %c\n", c);
                printf("Sua: thay '%c' bang '%c'\n",
                       c, getCorrectClose(topItem.bracket));
                error = 1;
                break;
            }
        }
    }

    if(!error){
        printf("\n Bieu thuc hop le ve dau ngoac.\n");
    }

    return 0;
}

// Bai 3: Infix -> Postfix va tinh gia tri (chi so 1 chu so, + - * /, khong dau ngoac)
#include <stdio.h>
#include <string.h>
#include <ctype.h>

#define MAX 1000

// ===== Stack cho toan tu (char) =====
typedef struct {
    char a[MAX];
    int top;
} StackChar;

void initChar(StackChar *s){
    s->top = -1;
}

int isEmptyChar(StackChar *s){
    return s->top == -1;
}

int isFullChar(StackChar *s){
    return s->top == MAX - 1;
}

void pushChar(StackChar *s, char value){
    if(isFullChar(s)) return;
    s->top++;
    s->a[s->top] = value;
}

char popChar(StackChar *s){
    char data = s->a[s->top];
    s->top--;
    return data;
}

char peekChar(StackChar *s){
    return s->a[s->top];
}

// ===== Stack cho so (int) =====
typedef struct {
    int a[MAX];
    int top;
} StackInt;

void initInt(StackInt *s){
    s->top = -1;
}

int isEmptyInt(StackInt *s){
    return s->top == -1;
}

int isFullInt(StackInt *s){
    return s->top == MAX - 1;
}

void pushInt(StackInt *s, int value){
    if(isFullInt(s)) return;
    s->top++;
    s->a[s->top] = value;
}

int popInt(StackInt *s){
    int data = s->a[s->top];
    s->top--;
    return data;
}

// ===== Ham uu tien toan tu =====
int priority(char op){
    if(op == '*' || op == '/') return 2;
    if(op == '+' || op == '-') return 1;
    return 0;
}

// ===== Chuyen Infix -> Postfix =====
void infixToPostfix(char infix[], char postfix[]){
    StackChar s;
    initChar(&s);

    int j = 0;
    for(int i = 0; infix[i] != '\0'; i++){
        char c = infix[i];
        if(c == ' ' || c == '\t') continue;

        if(isdigit((unsigned char)c)){
            postfix[j++] = c; // so 1 chu so
        } else if(c == '+' || c == '-' || c == '*' || c == '/'){
            while(!isEmptyChar(&s) && priority(peekChar(&s)) >= priority(c)){
                postfix[j++] = popChar(&s);
            }
            pushChar(&s, c);
        }
    }

    while(!isEmptyChar(&s)){
        postfix[j++] = popChar(&s);
    }
    postfix[j] = '\0';
}

// ===== Tinh gia tri Postfix =====
int evalPostfix(char postfix[], int *ok){
    StackInt s;
    initInt(&s);
    *ok = 1;

    for(int i = 0; postfix[i] != '\0'; i++){
        char c = postfix[i];

        if(isdigit((unsigned char)c)){
            pushInt(&s, c - '0');
        } else {
            if(s.top < 1){ *ok = 0; return 0; }
            int b = popInt(&s);
            int a = popInt(&s);

            if(c == '+') pushInt(&s, a + b);
            else if(c == '-') pushInt(&s, a - b);
            else if(c == '*') pushInt(&s, a * b);
            else if(c == '/'){
                if(b == 0){ *ok = 0; return 0; }
                pushInt(&s, a / b); // chia nguyen
            } else {
                *ok = 0; return 0;
            }
        }
    }

    if(s.top != 0){ *ok = 0; return 0; }
    return popInt(&s);
}

int main(){
    char infix[MAX], postfix[MAX];

    printf("Nhap bieu thuc: ");
    fgets(infix, MAX, stdin);
    infix[strcspn(infix, "\n")] = '\0';

    infixToPostfix(infix, postfix);

    int ok;
    int result = evalPostfix(postfix, &ok);

    printf("%s\n", postfix);
    if(ok) printf("Result = %d\n", result);
    else   printf("Result = ERROR\n");

    return 0;
}


//Bài 4
#include <stdio.h>
#define MAX 10

typedef struct {
    int head, tail;
    int a[MAX];
} Queue;

void init(Queue* q) {
    q->head = 0;
    q->tail = -1;
}

int isEmpty(Queue *q){
    if(q->head == -1 || q->head == q->tail + 1)
        return 1;
    return 0;
}

int isFull(Queue *q){
    if (q->tail == MAX - 1)
        return 1;
    return 0;
}
void put(Queue* q, int value){
    q->tail++;
    q->a[q->tail] = value;
}
int get(Queue* q){
    int data = q->a[q->head];
    q->head++;
    return data;
}
void displayQueue(Queue* q){
    if(isEmpty(q)){
        printf("Queue is empty");
        return;
    }
    for(int i = q->head; i <= q->tail; i++){
        printf("%d ", q->a[i]);
    }
}
void cancelRegistration(Queue* q, int user){
    if(isEmpty(q)){
        printf("Queue is empty\n");
        return;
    }

    int found = 0;
    for(int i = q->head; i <= q->tail; i++){
        if(q->a[i] == user){
            found = 1;
            // dich trai
            for(int j = i; j < q->tail; j++){
                q->a[j] = q->a[j + 1];
            }
            q->tail--;
            printf("Da huy dang ky nguoi dung %d\n", user);
            break;
        }
    }

    if(!found){
        printf("Khong tim thay nguoi dung %d\n", user);
    }
}

int main() {
    Queue q;
    init(&q);

    printf("Dang ky nguoi dung:\n");
    put(&q, 101);
    put(&q, 102);
    put(&q, 103);
    put(&q, 104);

    displayQueue(&q);
    printf("\n");

    printf("\nNguoi dang ky som nhat: %d\n", get(&q));
    displayQueue(&q);
    printf("\n");

    printf("\nHuy dang ky nguoi dung 103\n");
    cancelRegistration(&q, 103);
    displayQueue(&q);
    printf("\n");

    printf("\nDang ky nguoi dung 105\n");
    put(&q, 105);
    displayQueue(&q);
    printf("\n");

    return 0;
}



// Bài 5
// Bài 5: Cross the bridge
#include <stdio.h>
#include <stdlib.h>

#define MAX 1000

typedef struct {
    int a[MAX];
    int front;
    int rear;
    int size;
} Queue;

void init(Queue *q){
    q->front = 0;
    q->rear = -1;
    q->size = 0;
}

int isEmpty(Queue *q){
    return q->size == 0;
}

int isFull(Queue *q, int K){
    return q->size == K;
}

void enqueue(Queue *q, int value){
    if(q->size < MAX){
        q->rear = (q->rear + 1) % MAX;
        q->a[q->rear] = value;
        q->size++;
    }
}

int dequeue(Queue *q){
    if(q->size > 0){
        int val = q->a[q->front];
        q->front = (q->front + 1) % MAX;
        q->size--;
        return val;
    }
    return -1;
}

// Hàm so sánh để sắp xếp tăng dần
int cmp(const void *a, const void *b){
    return (*(int*)a - *(int*)b);
}

int main(){
    int K, N;
    int times[MAX];

    printf("Nhap tai trong cau K: ");
    scanf("%d", &K);
    printf("Nhap so nguoi N: ");
    scanf("%d", &N);

    printf("Nhap thoi gian tung nguoi: ");
    for(int i = 0; i < N; i++){
        scanf("%d", &times[i]);
    }

    // Sắp xếp thời gian tăng dần
    qsort(times, N, sizeof(int), cmp);

    Queue q;
    init(&q);

    int total = 0;
    for(int i = 0; i < N; i++){
        if(isFull(&q, K)){
            int removed = dequeue(&q);
            total -= removed;
        }
        enqueue(&q, times[i]);
        total += times[i];
    }

    printf("Tong thoi gian toi thieu = %d\n", total);

    return 0;
}


// Bài 6
// Bài 6: WIFI Access Control
#include <stdio.h>
#include <string.h>

#define MAX 100

// Cấu trúc thiết bị
typedef struct {
    char deviceID[50];
    char role[20];   // "staff", "guest", "admin"
    int auth;        // 1 = hợp lệ, 0 = không hợp lệ
} Device;

// Stack quản lý thiết bị kết nối vào 1 Access Point
typedef struct {
    Device a[MAX];
    int top;
} Stack;

void init(Stack *s){
    s->top = -1;
}

int isEmpty(Stack* s){
    return s->top == -1;
}

int isFull(Stack* s){
    return s->top == MAX - 1;
}

void push(Stack* s, Device d){
    if(!isFull(s)){
        s->top++;
        s->a[s->top] = d;
    }
}

Device pop(Stack* s){
    Device d = {"","",0};
    if(!isEmpty(s)){
        d = s->a[s->top];
        s->top--;
    }
    return d;
}

// Kiểm tra quyền truy cập
int checkAccess(Device d){
    if(d.auth == 0) return 0; // chưa xác thực
    if(strcmp(d.role, "guest") == 0) return 0; // khách bị chặn
    return 1; // staff, admin hợp lệ
}

int main(){
    Stack ap; // mô phỏng 1 Access Point
    init(&ap);

    int N;
    printf("Nhap so thiet bi muon ket noi: ");
    scanf("%d", &N);

    for(int i = 0; i < N; i++){
        Device d;
        printf("Nhap deviceID: ");
        scanf("%s", d.deviceID);
        printf("Nhap role (staff/guest/admin): ");
        scanf("%s", d.role);
        printf("Nhap trang thai xac thuc (1=OK,0=Fail): ");
        scanf("%d", &d.auth);

        if(checkAccess(d)){
            push(&ap, d);
            printf(">> Thiet bi %s duoc ket noi vao AP\n", d.deviceID);
        } else {
            printf(">> Thiet bi %s bi chan ket noi!\n", d.deviceID);
        }
    }

    printf("\nDanh sach thiet bi ket noi hop le:\n");
    while(!isEmpty(&ap)){
        Device d = pop(&ap);
        printf("DeviceID: %s | Role: %s\n", d.deviceID, d.role);
    }

    return 0;
}

